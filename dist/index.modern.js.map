{"version":3,"file":"index.modern.js","sources":["../src/components/DragMove.tsx","../src/index.tsx"],"sourcesContent":["import React, { useState } from \"react\";\n\n// @ts-expect-error\nexport default function DragMove(props) {\n  const {\n    onPointerDown,\n    onPointerUp,\n    onPointerMove,\n    onDragMove,\n    children,\n    style,\n    className\n  } = props;\n\n  const [isDragging, setIsDragging] = useState(false);\n\n  // @ts-expect-error\n  const handlePointerDown = (e) => {\n    setIsDragging(true);\n\n    onPointerDown(e);\n  };\n\n  // @ts-expect-error\n  const handlePointerUp = (e) => {\n    setIsDragging(false);\n\n    onPointerUp(e);\n  };\n\n  // @ts-expect-error\n  const handlePointerMove = (e) => {\n    if (isDragging) onDragMove(e);\n\n    onPointerMove(e);\n  };\n\n  return (\n    <div\n      onPointerDown={handlePointerDown}\n      onPointerUp={handlePointerUp}\n      onPointerMove={handlePointerMove}\n      style={style}\n      className={className}\n    >\n      {children}\n    </div>\n  );\n}\n\nDragMove.defaultProps = {\n  onPointerDown: () => {},\n  onPointerUp: () => {},\n  onPointerMove: () => {}\n};\n","import { Box, Container, makeStyles, Typography } from '@material-ui/core';\nimport { SpeedDial, SpeedDialAction } from '@material-ui/lab';\nimport * as React from 'react';\nimport DragMove from './components/DragMove';\nimport AccountBalanceWalletIcon from '@material-ui/icons/AccountBalanceWallet';\nimport WalletConnectProvider from '@walletconnect/web3-provider';\nimport PetsIcon from '@material-ui/icons/Pets';\n\nimport Web3 from 'web3';\nimport Web3Modal from \"web3modal\";\nimport { InstalledApp } from './types/installedApp';\nimport abi from './utils/abi/Byoa.json';\nimport { ethers } from 'ethers';\n\ninterface Props {\n  dataPipe? : {\n    data: any\n  }\n}\n\nconst byoaContractAddress = `0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512`;\nconst providerNetwork = `http://localhost:8545`;\nconst jrpcProvider = new ethers.providers.JsonRpcProvider('https://eth-mainnet.alchemyapi.io/v2/Uo717K-DDAxlSM5gXM-zgv678k0aMZH5', 'mainnet');\n\nlet listeners : any = [];\n// @ts-expect-error\nwindow.byoa = {\n  context: {\n    target: {\n      hud: \"byoa-hud\"\n    },\n    ethers: ethers,\n    provider: ethers.getDefaultProvider('https://eth-mainnet.alchemyapi.io/v2/Uo717K-DDAxlSM5gXM-zgv678k0aMZH5'),\n    jrpcProvider: jrpcProvider,\n    addDataListener: (cb : any) => {\n      listeners.push(cb);\n    },\n    account: {\n      address: null\n    }\n  }\n};\n\nconst useStyles = makeStyles({\n  root: {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    minWidth: '100vw',\n    minHeight: '100vh',\n    background: 'rgba(50,0,0,0.00)',\n    pointerEvents: 'none'\n  },\n  speedDial: {\n    position: 'fixed',\n    bottom: 20,\n    right: 20,\n    zIndex: 1000000000\n  },\n  byoaButton: {\n\n  }\n});\n\nconst providerOptions = {  \n  walletconnect: {\n    display: {\n      name: \"Mobile\"\n    },\n    package: WalletConnectProvider,\n    options: {\n      infuraId: \"6430aa46e9354b91bea44e464af71f7a\" // required\n    }\n  }\n};\n\nconst web3Modal = new Web3Modal({\n  network: providerNetwork, // optional\n  cacheProvider: true, // optional\n  disableInjectedProvider: false,\n  providerOptions // required\n});\n\n// @ts-expect-error\nexport const ByoaSDK = (props : Props) => {\n  const classes = useStyles();\n  const [translateDial, setTranslateDial] = React.useState({\n    x: 0,\n    y: 0\n  });\n  const [dialDirection, setDialDirection] = React.useState<\"left\" | \"right\" | \"up\" | \"down\" | undefined>(\"up\");\n  const [openDial, setOpenDial] = React.useState(false);\n  const [provider, setProvider] = React.useState<any>(null);\n  const [web3, setWeb3] = React.useState<any>(null);\n  const [accountAddress, setAccountAddress] = React.useState<String | null>(null);\n\n  const [installedApps, setInstalledApps] = React.useState<InstalledApp[]>([]);\n\n  \n  const connectWallet = async () => {\n    try {\n      let p = provider;\n      if (p === null) {\n        p = await web3Modal.connect();\n        if(p === null) {\n          throw new Error('Unable to connect provider to modal');\n        }\n        p.on('accountsChanged', (e : any) => {\n            console.log(e);\n          disconnectWallet();\n        });\n            p.on(\"chainChanged\", (chainId: number) => {\n                console.log(\"chain \" + chainId);\n            });\n        setProvider(p);\n      }\n\n      let w3 = web3;\n      if (w3 === null) {\n        w3 = new Web3(p);\n        if (w3 === null) {\n          throw new Error('Unable to connect web3');\n        }\n        setWeb3(w3);\n      }\n\n      const accounts = await p.request({method: 'eth_accounts'});\n      if (accounts.length > 0) {\n        setAccountAddress(accounts[0]);\n        setTimeout( async () => {\n            refreshMyApps(accounts[0]);\n        }, 2000);\n      }\n    } catch (error) {\n      console.log(error);\n      alert('Unable to connect wallet. Please try again.');\n    }\n  };\n\n  const disconnectWallet = async () => {\n    await web3Modal.clearCachedProvider();\n    setProvider(null);\n    setAccountAddress(null);\n  };\n\n  const getTokenMetadata = async (uri : string) : Promise<any> =>  {\n    return new Promise<any>( (resolve) => {\n      resolve({\n        meta: uri,\n        image: \"ipfs://QmYoSTehmdFUnSYCFrYdvSrEtNGy9U5gWEfroCTMGecHKw/0.png\",\n        byoa: {\n          browser: {\n            uri: \"http://localhost:3000/scripts/example1.js\",\n            target: \"host\"\n          }\n        }\n      });\n    });\n  };\n\n  const transformIPFSToPinned = (ipfsURI : String) : String => {\n    return `${ipfsURI}`;\n  }\n\n  const refreshMyApps = async (addressHelper : String | undefined | null) => {\n    let w3 = new Web3(providerNetwork);\n    try {\n        // @ts-expect-error\n        let contract = new w3.eth.Contract(abi.abi, byoaContractAddress);\n      \n        let myTokenIds = await contract.methods.walletOfOwner(accountAddress ? accountAddress : addressHelper).call();\n        console.log(myTokenIds);\n\n        let appLUT : any = {};\n        \n\n        let allInstalls : InstalledApp[] = [];\n        for (var i = 0; i < myTokenIds.length; i ++) {\n            let tid = parseInt(myTokenIds[i]);\n            let appIdForToken = await contract.methods.getAppIdByTokenId(tid).call();\n            let directTokenURI = await contract.methods.tokenURI(tid).call();\n            let tokenMeta = await getTokenMetadata(directTokenURI);\n            \n            if(appLUT[appIdForToken] !== null) {\n              let appDetails = await contract.methods.getAppDetailsById(parseInt(appIdForToken)).call();\n              appLUT[appIdForToken] = \n              {\n                id: appIdForToken,\n                name: appDetails[0],\n                description: appDetails[1],\n                tokenURI: appDetails[2],\n                owner: appDetails[3],\n                price: parseInt(appDetails[4]),\n                address: byoaContractAddress,\n                version: 'beta v0.1' \n              }\n            }\n\n            let ia : InstalledApp = {\n                id: tid,\n                tokenURI: directTokenURI,\n                app: appLUT[appIdForToken],\n                imageURI: tokenMeta.image,\n                byoaDetails: {\n                  uri: tokenMeta.byoa.browser.uri,\n                  target: tokenMeta.byoa.browser.target\n                }\n            }\n\n            allInstalls.push(ia);\n        }\n        console.log(allInstalls)\n        setInstalledApps(allInstalls);\n      \n    } catch( error ) {\n      console.log(`Error fetching apps: ${error}`) ;\n    }\n  };\n  \n  return (\n    <Box className={classes.root} id=\"byoa-hud\">\n      <Container className={classes.speedDial}>\n        <DragMove onDragMove={(e : any) => {\n          setTranslateDial({\n            x: translateDial.x + e.movementX,\n            y: translateDial.y + e.movementY\n          });\n          if (e.clientY < 200) {\n            if (dialDirection !== \"down\") setDialDirection(\"down\");\n          }\n          if (e.clientY > 200) {\n            if (dialDirection !== \"up\") setDialDirection(\"up\");\n          }\n        }}>\n          <SpeedDial\n            style={{\n              transform: `translateX(${translateDial.x}px) translateY(${translateDial.y}px)`\n            }}\n            ariaLabel=\"BYOA Speed Dial\"\n            hidden={false}\n            icon={<Typography className={classes.byoaButton}>RUN</Typography>}\n            open={openDial}\n            onOpen={() => {\n              setOpenDial(true);\n            }}\n            onClose={() => {\n              setOpenDial(false);\n            }}\n            onClick={() => {\n              \n            }}\n            direction={dialDirection}\n          >\n            <SpeedDialAction\n              key={'sda-connect-wallet'}\n              icon={<AccountBalanceWalletIcon />}\n              tooltipTitle={'Connect Wallet'}\n              onClick={() => {\n                connectWallet();\n              }}\n            />\n            {installedApps.map((installedApp, i) => (\n              <SpeedDialAction\n                key={`sd-action-${installedApp.id}-${i}`}\n                icon={<PetsIcon />}\n                tooltipTitle={`${installedApp.app.name} (#${installedApp.id})`}\n                onClick={() => {\n                  let scriptID = `byoa-${installedApp.id}-${installedApp.app.id}`;\n                  const existingApp = document.getElementById(scriptID);\n                  if (!existingApp) {\n                    const script = document.createElement('script');\n                    script.src = transformIPFSToPinned(installedApp.byoaDetails.uri) as string;\n                    script.id = scriptID;\n                    if(installedApp.byoaDetails.target == \"host\") {\n                      document.body.appendChild(script);\n                      script.onload = () => {\n                        // The script has loaded, possibly pass providers to it now\n                        console.log('loaded script');\n                      }\n                    }\n                  }\n                }}\n              />\n            ))}\n\n          </SpeedDial>\n        </DragMove>\n          \n      </Container>\n    </Box>\n  )\n}\n"],"names":["DragMove","props","onPointerDown","onPointerUp","onPointerMove","onDragMove","children","style","className","isDragging","setIsDragging","useState","handlePointerDown","e","handlePointerUp","handlePointerMove","React","defaultProps","byoaContractAddress","providerNetwork","jrpcProvider","ethers","providers","JsonRpcProvider","window","byoa","context","target","hud","provider","getDefaultProvider","addDataListener","cb","listeners","account","address","useStyles","makeStyles","root","position","top","left","minWidth","minHeight","background","pointerEvents","speedDial","bottom","right","zIndex","byoaButton","providerOptions","walletconnect","display","name","package","WalletConnectProvider","options","infuraId","web3Modal","Web3Modal","network","cacheProvider","disableInjectedProvider","ByoaSDK","classes","translateDial","setTranslateDial","x","y","dialDirection","setDialDirection","openDial","setOpenDial","setProvider","web3","setWeb3","accountAddress","setAccountAddress","installedApps","setInstalledApps","connectWallet","p","connect","Error","on","console","log","disconnectWallet","chainId","w3","Web3","accounts","request","method","length","setTimeout","refreshMyApps","error","alert","clearCachedProvider","getTokenMetadata","uri","Promise","resolve","meta","image","browser","transformIPFSToPinned","ipfsURI","addressHelper","contract","eth","Contract","abi","myTokenIds","methods","walletOfOwner","call","appLUT","allInstalls","i","tid","parseInt","appIdForToken","getAppIdByTokenId","directTokenURI","tokenURI","tokenMeta","appDetails","getAppDetailsById","id","description","owner","price","version","ia","app","imageURI","byoaDetails","push","Box","Container","movementX","movementY","clientY","SpeedDial","transform","ariaLabel","hidden","icon","Typography","open","onOpen","onClose","onClick","direction","SpeedDialAction","key","AccountBalanceWalletIcon","tooltipTitle","map","installedApp","PetsIcon","scriptID","existingApp","document","getElementById","script","createElement","src","body","appendChild","onload"],"mappings":";;;;;;;;;;SAGwBA,SAASC;AAC/B,QAAM;AACJC,IAAAA,aADI;AAEJC,IAAAA,WAFI;AAGJC,IAAAA,aAHI;AAIJC,IAAAA,UAJI;AAKJC,IAAAA,QALI;AAMJC,IAAAA,KANI;AAOJC,IAAAA;AAPI,MAQFP,KARJ;AAUA,QAAM,CAACQ,UAAD,EAAaC,aAAb,IAA8BC,QAAQ,CAAC,KAAD,CAA5C;;AAGA,QAAMC,iBAAiB,GAAIC,CAAD;AACxBH,IAAAA,aAAa,CAAC,IAAD,CAAb;AAEAR,IAAAA,aAAa,CAACW,CAAD,CAAb;AACD,GAJD;;AAOA,QAAMC,eAAe,GAAID,CAAD;AACtBH,IAAAA,aAAa,CAAC,KAAD,CAAb;AAEAP,IAAAA,WAAW,CAACU,CAAD,CAAX;AACD,GAJD;;AAOA,QAAME,iBAAiB,GAAIF,CAAD;AACxB,QAAIJ,UAAJ,EAAgBJ,UAAU,CAACQ,CAAD,CAAV;AAEhBT,IAAAA,aAAa,CAACS,CAAD,CAAb;AACD,GAJD;;AAMA,SACEG,4BAAA,MAAA;AACEd,IAAAA,aAAa,EAAEU;AACfT,IAAAA,WAAW,EAAEW;AACbV,IAAAA,aAAa,EAAEW;AACfR,IAAAA,KAAK,EAAEA;AACPC,IAAAA,SAAS,EAAEA;GALb,EAOGF,QAPH,CADF;AAWD;AAEDN,QAAQ,CAACiB,YAAT,GAAwB;AACtBf,EAAAA,aAAa,EAAE,QADO;AAEtBC,EAAAA,WAAW,EAAE,QAFS;AAGtBC,EAAAA,aAAa,EAAE;AAHO,CAAxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9BA,MAAMc,mBAAmB,+CAAzB;AACA,MAAMC,eAAe,0BAArB;AACA,MAAMC,YAAY,GAAG,IAAIC,MAAM,CAACC,SAAP,CAAiBC,eAArB,CAAqC,uEAArC,EAA8G,SAA9G,CAArB;AAEA,AAEAC,MAAM,CAACC,IAAP,GAAc;AACZC,EAAAA,OAAO,EAAE;AACPC,IAAAA,MAAM,EAAE;AACNC,MAAAA,GAAG,EAAE;AADC,KADD;AAIPP,IAAAA,MAAM,EAAEA,MAJD;AAKPQ,IAAAA,QAAQ,EAAER,MAAM,CAACS,kBAAP,CAA0B,uEAA1B,CALH;AAMPV,IAAAA,YAAY,EAAEA,YANP;AAOPW,IAAAA,eAAe,EAAGC,EAAD;AACfC,AACD,KATM;AAUPC,IAAAA,OAAO,EAAE;AACPC,MAAAA,OAAO,EAAE;AADF;AAVF;AADG,CAAd;AAiBA,MAAMC,SAAS,GAAGC,UAAU,CAAC;AAC3BC,EAAAA,IAAI,EAAE;AACJC,IAAAA,QAAQ,EAAE,OADN;AAEJC,IAAAA,GAAG,EAAE,CAFD;AAGJC,IAAAA,IAAI,EAAE,CAHF;AAIJC,IAAAA,QAAQ,EAAE,OAJN;AAKJC,IAAAA,SAAS,EAAE,OALP;AAMJC,IAAAA,UAAU,EAAE,mBANR;AAOJC,IAAAA,aAAa,EAAE;AAPX,GADqB;AAU3BC,EAAAA,SAAS,EAAE;AACTP,IAAAA,QAAQ,EAAE,OADD;AAETQ,IAAAA,MAAM,EAAE,EAFC;AAGTC,IAAAA,KAAK,EAAE,EAHE;AAITC,IAAAA,MAAM,EAAE;AAJC,GAVgB;AAgB3BC,EAAAA,UAAU,EAAE;AAhBe,CAAD,CAA5B;AAqBA,MAAMC,eAAe,GAAG;AACtBC,EAAAA,aAAa,EAAE;AACbC,IAAAA,OAAO,EAAE;AACPC,MAAAA,IAAI,EAAE;AADC,KADI;AAIbC,IAAAA,OAAO,EAAEC,qBAJI;AAKbC,IAAAA,OAAO,EAAE;AACPC,MAAAA,QAAQ,EAAE;AADH;AALI;AADO,CAAxB;AAYA,MAAMC,SAAS,GAAG,IAAIC,SAAJ,CAAc;AAC9BC,EAAAA,OAAO,EAAE1C,eADqB;AAE9B2C,EAAAA,aAAa,EAAE,IAFe;AAG9BC,EAAAA,uBAAuB,EAAE,KAHK;AAI9BZ,EAAAA;AAJ8B,CAAd,CAAlB;AAQA,MAAaa,OAAO,GAAI/D,KAAD;AACrB,QAAMgE,OAAO,GAAG7B,SAAS,EAAzB;AACA,QAAM,CAAC8B,aAAD,EAAgBC,gBAAhB,IAAoCnD,QAAA,CAAe;AACvDoD,IAAAA,CAAC,EAAE,CADoD;AAEvDC,IAAAA,CAAC,EAAE;AAFoD,GAAf,CAA1C;AAIA,QAAM,CAACC,aAAD,EAAgBC,gBAAhB,IAAoCvD,QAAA,CAA6D,IAA7D,CAA1C;AACA,QAAM,CAACwD,QAAD,EAAWC,WAAX,IAA0BzD,QAAA,CAAe,KAAf,CAAhC;AACA,QAAM,CAACa,QAAD,EAAW6C,WAAX,IAA0B1D,QAAA,CAAoB,IAApB,CAAhC;AACA,QAAM,CAAC2D,IAAD,EAAOC,OAAP,IAAkB5D,QAAA,CAAoB,IAApB,CAAxB;AACA,QAAM,CAAC6D,cAAD,EAAiBC,iBAAjB,IAAsC9D,QAAA,CAA8B,IAA9B,CAA5C;AAEA,QAAM,CAAC+D,aAAD,EAAgBC,gBAAhB,IAAoChE,QAAA,CAA+B,EAA/B,CAA1C;;AAGA,QAAMiE,aAAa,GAAG;AACpB,QAAI;AACF,UAAIC,CAAC,GAAGrD,QAAR;;AACA,UAAIqD,CAAC,KAAK,IAAV,EAAgB;AACdA,QAAAA,CAAC,GAAG,MAAMvB,SAAS,CAACwB,OAAV,EAAV;;AACA,YAAGD,CAAC,KAAK,IAAT,EAAe;AACb,gBAAM,IAAIE,KAAJ,CAAU,qCAAV,CAAN;AACD;;AACDF,QAAAA,CAAC,CAACG,EAAF,CAAK,iBAAL,EAAyBxE,CAAD;AACpByE,UAAAA,OAAO,CAACC,GAAR,CAAY1E,CAAZ;AACF2E,UAAAA,gBAAgB;AACjB,SAHD;AAIIN,QAAAA,CAAC,CAACG,EAAF,CAAK,cAAL,EAAsBI,OAAD;AACjBH,UAAAA,OAAO,CAACC,GAAR,CAAY,WAAWE,OAAvB;AACH,SAFD;AAGJf,QAAAA,WAAW,CAACQ,CAAD,CAAX;AACD;;AAED,UAAIQ,EAAE,GAAGf,IAAT;;AACA,UAAIe,EAAE,KAAK,IAAX,EAAiB;AACfA,QAAAA,EAAE,GAAG,IAAIC,IAAJ,CAAST,CAAT,CAAL;;AACA,YAAIQ,EAAE,KAAK,IAAX,EAAiB;AACf,gBAAM,IAAIN,KAAJ,CAAU,wBAAV,CAAN;AACD;;AACDR,QAAAA,OAAO,CAACc,EAAD,CAAP;AACD;;AAED,YAAME,QAAQ,GAAG,MAAMV,CAAC,CAACW,OAAF,CAAU;AAACC,QAAAA,MAAM,EAAE;AAAT,OAAV,CAAvB;;AACA,UAAIF,QAAQ,CAACG,MAAT,GAAkB,CAAtB,EAAyB;AACvBjB,QAAAA,iBAAiB,CAACc,QAAQ,CAAC,CAAD,CAAT,CAAjB;AACAI,QAAAA,UAAU,CAAE;AACRC,UAAAA,aAAa,CAACL,QAAQ,CAAC,CAAD,CAAT,CAAb;AACH,SAFS,EAEP,IAFO,CAAV;AAGD;AACF,KAjCD,CAiCE,OAAOM,KAAP,EAAc;AACdZ,MAAAA,OAAO,CAACC,GAAR,CAAYW,KAAZ;AACAC,MAAAA,KAAK,CAAC,6CAAD,CAAL;AACD;AACF,GAtCD;;AAwCA,QAAMX,gBAAgB,GAAG;AACvB,UAAM7B,SAAS,CAACyC,mBAAV,EAAN;AACA1B,IAAAA,WAAW,CAAC,IAAD,CAAX;AACAI,IAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACD,GAJD;;AAMA,QAAMuB,gBAAgB,GAAG,MAAOC,GAAP;AACvB,WAAO,IAAIC,OAAJ,CAAmBC,OAAD;AACvBA,MAAAA,OAAO,CAAC;AACNC,QAAAA,IAAI,EAAEH,GADA;AAENI,QAAAA,KAAK,EAAE,6DAFD;AAGNjF,QAAAA,IAAI,EAAE;AACJkF,UAAAA,OAAO,EAAE;AACPL,YAAAA,GAAG,EAAE,2CADE;AAEP3E,YAAAA,MAAM,EAAE;AAFD;AADL;AAHA,OAAD,CAAP;AAUD,KAXM,CAAP;AAYD,GAbD;;AAeA,QAAMiF,qBAAqB,GAAIC,OAAD;AAC5B,cAAUA,SAAV;AACD,GAFD;;AAIA,QAAMZ,aAAa,GAAG,MAAOa,aAAP;AACpB,QAAIpB,EAAE,GAAG,IAAIC,IAAJ,CAASxE,eAAT,CAAT;;AACA,QAAI;AAEA,UAAI4F,QAAQ,GAAG,IAAIrB,EAAE,CAACsB,GAAH,CAAOC,QAAX,CAAoBC,KAAG,CAACA,GAAxB,EAA6BhG,mBAA7B,CAAf;AAEA,UAAIiG,UAAU,GAAG,MAAMJ,QAAQ,CAACK,OAAT,CAAiBC,aAAjB,CAA+BxC,cAAc,GAAGA,cAAH,GAAoBiC,aAAjE,EAAgFQ,IAAhF,EAAvB;AACAhC,MAAAA,OAAO,CAACC,GAAR,CAAY4B,UAAZ;AAEA,UAAII,MAAM,GAAS,EAAnB;AAGA,UAAIC,WAAW,GAAoB,EAAnC;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,UAAU,CAACpB,MAA/B,EAAuC0B,CAAC,EAAxC,EAA6C;AACzC,YAAIC,GAAG,GAAGC,QAAQ,CAACR,UAAU,CAACM,CAAD,CAAX,CAAlB;AACA,YAAIG,aAAa,GAAG,MAAMb,QAAQ,CAACK,OAAT,CAAiBS,iBAAjB,CAAmCH,GAAnC,EAAwCJ,IAAxC,EAA1B;AACA,YAAIQ,cAAc,GAAG,MAAMf,QAAQ,CAACK,OAAT,CAAiBW,QAAjB,CAA0BL,GAA1B,EAA+BJ,IAA/B,EAA3B;AACA,YAAIU,SAAS,GAAG,MAAM3B,gBAAgB,CAACyB,cAAD,CAAtC;;AAEA,YAAGP,MAAM,CAACK,aAAD,CAAN,KAA0B,IAA7B,EAAmC;AACjC,cAAIK,UAAU,GAAG,MAAMlB,QAAQ,CAACK,OAAT,CAAiBc,iBAAjB,CAAmCP,QAAQ,CAACC,aAAD,CAA3C,EAA4DN,IAA5D,EAAvB;AACAC,UAAAA,MAAM,CAACK,aAAD,CAAN,GACA;AACEO,YAAAA,EAAE,EAAEP,aADN;AAEEtE,YAAAA,IAAI,EAAE2E,UAAU,CAAC,CAAD,CAFlB;AAGEG,YAAAA,WAAW,EAAEH,UAAU,CAAC,CAAD,CAHzB;AAIEF,YAAAA,QAAQ,EAAEE,UAAU,CAAC,CAAD,CAJtB;AAKEI,YAAAA,KAAK,EAAEJ,UAAU,CAAC,CAAD,CALnB;AAMEK,YAAAA,KAAK,EAAEX,QAAQ,CAACM,UAAU,CAAC,CAAD,CAAX,CANjB;AAOE9F,YAAAA,OAAO,EAAEjB,mBAPX;AAQEqH,YAAAA,OAAO,EAAE;AARX,WADA;AAWD;;AAED,YAAIC,EAAE,GAAkB;AACpBL,UAAAA,EAAE,EAAET,GADgB;AAEpBK,UAAAA,QAAQ,EAAED,cAFU;AAGpBW,UAAAA,GAAG,EAAElB,MAAM,CAACK,aAAD,CAHS;AAIpBc,UAAAA,QAAQ,EAAEV,SAAS,CAACtB,KAJA;AAKpBiC,UAAAA,WAAW,EAAE;AACXrC,YAAAA,GAAG,EAAE0B,SAAS,CAACvG,IAAV,CAAekF,OAAf,CAAuBL,GADjB;AAEX3E,YAAAA,MAAM,EAAEqG,SAAS,CAACvG,IAAV,CAAekF,OAAf,CAAuBhF;AAFpB;AALO,SAAxB;AAWA6F,QAAAA,WAAW,CAACoB,IAAZ,CAAiBJ,EAAjB;AACH;;AACDlD,MAAAA,OAAO,CAACC,GAAR,CAAYiC,WAAZ;AACAxC,MAAAA,gBAAgB,CAACwC,WAAD,CAAhB;AAEH,KAhDD,CAgDE,OAAOtB,KAAP,EAAe;AACfZ,MAAAA,OAAO,CAACC,GAAR,yBAAoCW,OAApC;AACD;AACF,GArDD;;AAuDA,SACElF,aAAA,CAAC6H,GAAD;AAAKrI,IAAAA,SAAS,EAAEyD,OAAO,CAAC3B;AAAM6F,IAAAA,EAAE,EAAC;GAAjC,EACEnH,aAAA,CAAC8H,SAAD;AAAWtI,IAAAA,SAAS,EAAEyD,OAAO,CAACnB;GAA9B,EACE9B,aAAA,CAAChB,QAAD;AAAUK,IAAAA,UAAU,EAAGQ,CAAD;AACpBsD,MAAAA,gBAAgB,CAAC;AACfC,QAAAA,CAAC,EAAEF,aAAa,CAACE,CAAd,GAAkBvD,CAAC,CAACkI,SADR;AAEf1E,QAAAA,CAAC,EAAEH,aAAa,CAACG,CAAd,GAAkBxD,CAAC,CAACmI;AAFR,OAAD,CAAhB;;AAIA,UAAInI,CAAC,CAACoI,OAAF,GAAY,GAAhB,EAAqB;AACnB,YAAI3E,aAAa,KAAK,MAAtB,EAA8BC,gBAAgB,CAAC,MAAD,CAAhB;AAC/B;;AACD,UAAI1D,CAAC,CAACoI,OAAF,GAAY,GAAhB,EAAqB;AACnB,YAAI3E,aAAa,KAAK,IAAtB,EAA4BC,gBAAgB,CAAC,IAAD,CAAhB;AAC7B;AACF;GAXD,EAYEvD,aAAA,CAACkI,SAAD;AACE3I,IAAAA,KAAK,EAAE;AACL4I,MAAAA,SAAS,gBAAgBjF,aAAa,CAACE,mBAAmBF,aAAa,CAACG;AADnE;AAGP+E,IAAAA,SAAS,EAAC;AACVC,IAAAA,MAAM,EAAE;AACRC,IAAAA,IAAI,EAAEtI,aAAA,CAACuI,UAAD;AAAY/I,MAAAA,SAAS,EAAEyD,OAAO,CAACf;KAA/B,OAAA;AACNsG,IAAAA,IAAI,EAAEhF;AACNiF,IAAAA,MAAM,EAAE;AACNhF,MAAAA,WAAW,CAAC,IAAD,CAAX;AACD;AACDiF,IAAAA,OAAO,EAAE;AACPjF,MAAAA,WAAW,CAAC,KAAD,CAAX;AACD;AACDkF,IAAAA,OAAO,EAAE;AAGTC,IAAAA,SAAS,EAAEtF;GAjBb,EAmBEtD,aAAA,CAAC6I,eAAD;AACEC,IAAAA,GAAG,EAAE;AACLR,IAAAA,IAAI,EAAEtI,aAAA,CAAC+I,wBAAD,MAAA;AACNC,IAAAA,YAAY,EAAE;AACdL,IAAAA,OAAO,EAAE;AACP1E,MAAAA,aAAa;AACd;GANH,CAnBF,EA2BGF,aAAa,CAACkF,GAAd,CAAkB,CAACC,YAAD,EAAezC,CAAf,KACjBzG,aAAA,CAAC6I,eAAD;AACEC,IAAAA,GAAG,eAAeI,YAAY,CAAC/B,MAAMV;AACrC6B,IAAAA,IAAI,EAAEtI,aAAA,CAACmJ,QAAD,MAAA;AACNH,IAAAA,YAAY,KAAKE,YAAY,CAACzB,GAAb,CAAiBnF,UAAU4G,YAAY,CAAC/B;AACzDwB,IAAAA,OAAO,EAAE;AACP,UAAIS,QAAQ,WAAWF,YAAY,CAAC/B,MAAM+B,YAAY,CAACzB,GAAb,CAAiBN,IAA3D;AACA,YAAMkC,WAAW,GAAGC,QAAQ,CAACC,cAAT,CAAwBH,QAAxB,CAApB;;AACA,UAAI,CAACC,WAAL,EAAkB;AAChB,cAAMG,MAAM,GAAGF,QAAQ,CAACG,aAAT,CAAuB,QAAvB,CAAf;AACAD,QAAAA,MAAM,CAACE,GAAP,GAAa9D,qBAAqB,CAACsD,YAAY,CAACvB,WAAb,CAAyBrC,GAA1B,CAAlC;AACAkE,QAAAA,MAAM,CAACrC,EAAP,GAAYiC,QAAZ;;AACA,YAAGF,YAAY,CAACvB,WAAb,CAAyBhH,MAAzB,IAAmC,MAAtC,EAA8C;AAC5C2I,UAAAA,QAAQ,CAACK,IAAT,CAAcC,WAAd,CAA0BJ,MAA1B;;AACAA,UAAAA,MAAM,CAACK,MAAP,GAAgB;AAEdvF,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACD,WAHD;AAID;AACF;AACF;GAnBH,CADD,CA3BH,CAZF,CADF,CADF,CADF;AAwED,CA/MM;;;;"}